# BASH LINUX

## Основные основы

### Логические операторы

| Обозначение                  | Описание                                                   |
| :--------------------------- | :--------------------------------------------------------- |
| n1 -eq n2, (n1 == n2)        | Возвращает истинное значение, если n1 равно n2.            |
| n1 -ge n2, (n1 >= n2)        | Возвращает истинное значение, если n1 больше или равно n2. |
| n1 -gt n2, (n1 > n2)         | Возвращает истинное значение, если n1 больше n2.           |
| n1 -le n2, (n1 <= n2)        | Возвращает истинное значение, если n1 меньше или равно n2. |
| n1 -lt n2, (n1 < n2)         | Возвращает истинное значение, если n1 меньше n2.           |
| n1 -ne n2, (n1 != n2)        | Возвращает истинное значение, если n1 не равно n2.         |
| str1 = str2, (str1 == str2)  | Возвращает истинное значение, если строки идентичны.       |
| str1 != str2                 | Возвращает истинное значение, если строки не идентичны.    |
| str1 < str2                  | Возвращает истинное значение, если str1 меньше, чем str2.  |
| str1 > str2                  | Возвращает истинное значение, если str1 больше, чем str2.  |
| -n str1, (length(str1) > 0)  | Возвращает истинное значение, если длина str1 больше нуля. |
| -z str1, (length(str1) == 0) | Возвращает истинное значение, если длина str1 равна нулю.  |
| !                            | Отрицание логического выражения                            |
| -a, (&&)                     | логическое «И»                                             |
| -o, (\|\|)                   | логическое «ИЛИ»                                           |

> В качестве команд возвращающих код возврата могут выступать структуры [[условие]], [ условие ], test, (( условие )).

| Обозначение   | Описание                                                                                                        |
| :------------ | :-------------------------------------------------------------------------------------------------------------- |
| test          | Возвращает 0(TRUE) или 1(FALSE). Например: test 3 -gt 4 вернет 1(FALSE).                                        |
| [ условие ]   | Синоним команды test.                                                                                           |
| [[условие]]   | Расширенная версия "[" (начиная с версии 2.02), внутри которой могут быть использованы \|\|(или), &&(и).        |
| (( условие )) | математическое сравнение. Возвращает 1, если выражение равно 0, или 0, если выражение имеет ненулевое значение. |

---

### Проверка файлов

| Обозначение     | Описание                                                                                                                |
| :-------------- | :---------------------------------------------------------------------------------------------------------------------- |
| -d file         | Проверяет, существует ли файл, и является ли он директорией.                                                            |
| -e file         | Проверяет, существует ли файл (также -a).                                                                               |
| -f file         | Проверяет, существует ли файл, и является ли он файлом.                                                                 |
| -h              | Символьная ссылка (также -L).                                                                                           |
| -r file         | Проверяет, существует ли файл, и доступен ли он для чтения.                                                             |
| -s file         | Проверяет, существует ли файл, и не является ли он пустым.                                                              |
| -w file         | Проверяет, существует ли файл, и доступен ли он для записи.                                                             |
| -x file         | Проверяет, существует ли файл, и является ли он исполняемым.                                                            |
| -N file         | Был ли изменен со времени последнего прочтения.                                                                         |
| file1 -nt file2 | Проверяет, новее ли file1, чем file2.                                                                                   |
| file1 -ot file2 | Проверяет, старше ли file1, чем file2.                                                                                  |
| file1 -ef file2 | Проверяет, является ли file1 жесткой ссылкой на file2.                                                                  |
| -O file         | Проверяет, существует ли файл, и является ли его владельцем текущий пользователь.                                       |
| -G file         | Проверяет, существует ли файл, и соответствует ли его идентификатор группы идентификатору группы текущего пользователя. |

---

### Математические операции

| Обозначение | Описание                                                                                                                                                                                                                                            |
| :---------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| let         | Команда производящая арифметические операции над числами и переменными: let "c = a + b". Позволяет использовать сокращения арифметических команд, тем самым сокращая кол-во используемых переменных. Например: a = a + b эквивалентно a += b и т.п. |
| +           | Сложение.                                                                                                                                                                                                                                           |
| -           | Вычитание.                                                                                                                                                                                                                                          |
| \*          | Умножение.                                                                                                                                                                                                                                          |
| /           | Деление.                                                                                                                                                                                                                                            |
| \*\*        | Возведение в степень.                                                                                                                                                                                                                               |
| %           | Модуль (деление по модулю), Остаток от деления.                                                                                                                                                                                                     |
| ++          | Инкремент.                                                                                                                                                                                                                                          |
| --          | Декремент.                                                                                                                                                                                                                                          |

---

### Перенаправление потоков

| Обозначение | Описание                                                                                                                                    |
| :---------- | :------------------------------------------------------------------------------------------------------------------------------------------ |
| 0 (stdin)   | Стандартный ввод. Это все что набирает юзер в консоли.                                                                                      |
| 1 (stdout)  | Стандартный вывод. Сюда попадает все что выводят программы.                                                                                 |
| 2 (stderr)  | Стандартный вывод ошибок.                                                                                                                   |
| >           | (перенаправление вывода). Если есть необходимость дописывать в файл (при использовании ">" он заменяется), то вместо ">" использовать ">>". |
| <           | (перенаправление ввода).                                                                                                                    |

---

### Зарезервированные переменные bash

| Обозначение | Описание                                                                |
| :---------- | :---------------------------------------------------------------------- |
| $#          | Общее количество параметров переданных скрипту.                         |
| ${!#}       | Последний из переданных скрипту параметров.                             |
| $\*         | Все аргументы переданыне скрипту(выводятся в строку).                   |
| $@          | Тоже самое, что и предыдущий, но параметры выводятся в столбик.         |
| $!          | PID последнего запущенного в фоне процесса.                             |
| $$          | PID самого скрипта.                                                     |
| $?          | Статус возврата значения (присваивается этой переменной через return) . |
| basename $0 | Название скрипта без абсолютного или относительного пути.               |

---

### Функции bash

Пример возврата значения переменной из функции:
Вариант1: по ссылке на переменную

    ./script_with_function.sh
    !#/bin/bash
    set -euo pipefail
    function return_entered_username() {
        # какие-то действия <!с выводом сообщений!>
        local -n username_func=$1
        local uservar
        while true; do
            read -p 'Введите имя пользователя: ' uservar
            username_func=${uservar// /_}
            # какие-то действия <!с выводом сообщений!>
            if [[ -z "$username_func" ]]; then
                echo "Ошибка: пустое имя пользователя"
            elif [[ "$username_func" =~ ^[a-zA-Z0-9_]*$ ]]; then
                break
            else
                echo "Ошибка: некорректные символы в имени пользователя"
            fi
        done
        return 0
    }

    ./script2.sh
    #!/bin/bash
    set -euo pipefail
    source /path/to/script_with_function.sh
    return_entered_username username
    echo "$username"

Вариант 2: возврат через поток stdout

    ./script_with_function.sh
    !#/bin/bash
    set -euo pipefail
    function return_entered_username() {
        # какие-то действия <!без вывода сообщений!>
        local uservar
        while true; do
            read -p 'Введите имя пользователя: ' uservar
            local username=${uservar// /_}
            # какие-то действия <!без вывода сообщений!>
            if [[ "$username" =~ ^[a-zA-Z0-9_]*$ ]]; then
                break
            fi
        done
        echo $username
        return 0
    }

    ./script2.sh
    set -euo pipefail
    #!/bin/bash
    source /path/to/script_with_function.sh
    username=$(return_entered_username)
    echo "$username"

Вариант 3: используем массивы

    ./script_with_function.sh
    !#/bin/bash
    set -euo pipefail
    function return_entered_username() {
        # какие-то действия <!с выводом сообщений!>
        local uservar
        while true; do
            read -p 'Введите имя пользователя: ' uservar
            local username=${uservar// /_}
            # какие-то действия <!с выводом сообщений!>
            if [[ -z "$username" ]]; then
                echo "Ошибка: пустое имя пользователя"
            elif [[ "$username" =~ ^[a-zA-Z0-9_]*$ ]]; then
                break
            else
                echo "Ошибка: некорректные символы в имени пользователя"
            fi
        done
        echo $username
        return 0
    }

    ./script2.sh
    #!/bin/bash
    set -euo pipefail
    source /path/to/script_with_function.sh
    declare -a username
    username=($(return_entered_username))
    echo "${username[-1]}"

---

### Мои функции bash

Скрипт file_operation.sh

| Обозначение      | Описание                                       |
| :--------------- | :--------------------------------------------- |
| file_info()      | Полная информация о файле (через команду stat) |
| isFile()         | Это файл? Да-0/Нет-1.                          |
| isWritableFile() | Этот файл доступен для записи? Да-0/Нет-1.     |
| isFolder()       | Это директория? Да-0/Нет-1.                    |

Скрипт return_entered_data.sh

| Обозначение               | Описание                                                                                           |
| :------------------------ | :------------------------------------------------------------------------------------------------- |
| return_entered_username() | Ввод имени пользователя (по шаблону) с дополнительным логгированием и проверками                   |
| return_entered_email()    | Ввод e-mail (по шаблону) с дополнительным логгированием и проверками                               |
| return_entered_phone()    | Ввод телефона (по шаблону) с дополнительным логгированием и проверками                             |
| return_entered_path()     | Ввод абсолютного положения файла/каталога (по шаблону) с дополнительным логгированием и проверками |

Скрипты:

| Обозначение     | Описание                                                                                                                   |
| :-------------- | :------------------------------------------------------------------------------------------------------------------------- |
| configure_pc.sh | Настройка конфигурации установки программы.                                                                                |
| setup_pc.sh     | Установка программы (по папкам, с ярлыком на рабочем столе).                                                               |
| uninstall_pc.sh | Удаление программы.                                                                                                        |
| log_analysis.sh | Анализ лог-файлов по датам, по ключевым словам, по количеству запусков программы (по месяцам/дням/часам), по видам ошибок. |
